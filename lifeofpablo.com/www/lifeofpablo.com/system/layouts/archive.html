<!---------------------------
archive.html
Description: This code creates an archive in the style of Hugo's PaperMod theme. The design is your responsibility. 

Created by Robert Pfotenhauer on 03.10.23.
---------------------------->


<?php $this->yellow->layout("header") ?>

<h1><?php echo $this->yellow->page->getHtml("titleContent") ?></h1>
<?php echo $this->yellow->page->getContentHtml() ?>

<?php $pages = $this->yellow->content->index()->filter("layout", "blog")->sort("published", false) ?>

    <?php 
    $yearCounts  = []; // An array to record the number of posts per year
    $monthCounts = []; // An array to record the number of posts per month
    
    foreach ($pages as $page): 
        $publishedDate = strtotime($page->get("published"));
        $year = date("Y", $publishedDate); // Das Jahr des Beitrags
        $month = date("m", $publishedDate); // Der Monat des Beitrags
    
        // Count the posts per year
        if (isset($yearCounts[$year])) {
            $yearCounts[$year]++;
        } else {
            $yearCounts[$year] = 1;
        }
    
        // Count the posts per month
        $monthKey = $year . "-" . $month;
        if (isset($monthCounts[$monthKey])) {
            $monthCounts[$monthKey]++;
        } else {
            $monthCounts[$monthKey] = 1;
        }
    endforeach; 
    
    // Group posts by year and month
    $groupedPosts = [];
    foreach ($pages as $page):
        $publishedDate = strtotime($page->get("published"));
        $year = date("Y", $publishedDate);
        $month = date("m", $publishedDate);
        $groupKey = $year . "-" . $month;
    
        if (!isset($groupedPosts[$year])) {
            $groupedPosts[$year] = [];
        }
    
        if (!isset($groupedPosts[$year][$month])) {
            $groupedPosts[$year][$month] = [];
        }
    
        $groupedPosts[$year][$month][] = $page;
    endforeach;
    
    // Loop through the grouped posts and output them
    foreach ($groupedPosts as $year => $yearGroup): ?>
    
    <div class="archive-year">
    <h2><?php echo $year ?> <sup class="archive-count">(<?php echo $yearCounts[$year] ?>)</sup></h2>
    
    <?php foreach ($yearGroup as $month => $monthGroup): ?>
    
        <div class="archive-month">    
            <div class="archive-month__header">
            <strong><?php echo date("F", strtotime("2023-" . $month . "-01")) ?> <sup class="archive-count">(<?php echo $monthCounts[$year . "-" . $month] ?>)</sup></strong>
            </div>
            <div class="archive-posts">
            <?php foreach ($monthGroup as $page): ?>
                <div class="archive-entry">
                    <?php echo $page->getHtml("title") ?>
                    <div class="archive-meta">
                        <?php echo $page->getDateHtml("published") ?>
                        <?php echo " &middot; " . $page->parseContentShortcut("readingtime", "", "inline") . " min"; ?>
                    </div>
                    <a class="entry-link" aria-label="<?php echo $page->getHtml("title") ?>" title="<?php echo $page->getHtml("title") ?>" href="<?php echo $page->getLocation(true) ?>">&nbsp;</a>
                </div>
            <?php endforeach; ?>
            </div>
        </div>
    </div>
    
    <?php endforeach; ?>
    <?php endforeach; ?>

<?php $this->yellow->layout("footer") ?>
