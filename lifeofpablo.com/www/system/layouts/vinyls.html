<?php $this->yellow->layout("header") ?>
<h1><?php echo $this->yellow->page->getHtml("titleContent") ?></h1>

<div class="content">
  <div class="main h-entry" role="main">
    <header class="tc ph4">
      <h1 class="f3 f2-m f1-l fw2 mv3">
        <?php echo $this->yellow->page->getHtml("titleContent") ?>
      </h1>
      <h2 class="f5 f4-m f3-l fw2 black-50 mt0 lh-copy">
        <?php echo $this->yellow->page->getHtml("Description") ?>
      </h2>
    </header>
    
    
  


   
<?php

// --- Configuration for Vinyl Data ---
$vinyls_api_url = 'https://api.lifeofpablo.com/vinyls';
$discogs_search_url = 'https://www.discogs.com/search/?q=';
$discogs_search_type = '&type=all&format_exact=Vinyl';

// --- Fetch and Decode Vinyl Data ---
$catalog_json = file_get_contents($vinyls_api_url);
$decoded_json = json_decode($catalog_json, true);

// --- Handle Potential Errors ---
if ($decoded_json === null || !isset($decoded_json['data'])) {
    echo '<p>Error loading vinyl catalog data.</p>';
    exit;
}

$vinyls = $decoded_json['data'];

// --- Store Vinyls in an associative array for easy lookup by ID ---
$vinyls_by_id = [];
foreach ($vinyls as $v) {
    if (isset($v['id'])) {
        $vinyls_by_id[$v['id']] = $v;
    }
}

// ====================================================================
// NEW LOGIC: Check for a requested vinyl ID in the URL
// ====================================================================
$requested_id = isset($_GET['id']) ? $_GET['id'] : null;

if ($requested_id && isset($vinyls_by_id[$requested_id])) {
    
    // --- Display a Single Vinyl Page ---
    $vinyl = $vinyls_by_id[$requested_id];
    $name = $vinyl['title'];
    $artist = $vinyl['artist'];
    $cover = $vinyl['thumbnail_url'];
    $year = $vinyl['copyright_year'];
    $label = $vinyl['label'];
    $genre = isset($vinyl['genre']) ? $vinyl['genre'] : 'Unknown';
    $info_url = $vinyl['info_url'];

    echo '<h1>' . $name . ' by ' . $artist . '</h1>';
    echo '<p><a href="vinyls">Back to Catalog</a></p>';
    echo '<div class="single-vinyl-details" style="display:flex; gap: 20px;">';
    echo '<img style="max-width:50%; height: 50%;" alt="' . $name . ' Album Cover" src="' . $cover . '">';
    echo '<div>';
    echo '<h2>Details</h2>';
    echo '<p><strong>Artist:</strong> ' . $artist . '</p>';
    echo '<p><strong>Year:</strong> ' . $year . '</p>';
    echo '<p><strong>Label:</strong> ' . $label . '</p>';
    // echo '<p><strong>Genre:</strong> ' . $genre . '</p>';
    echo '<p><strong>More Info:</strong> <a target="_blank" href="' . $info_url . '">View Info Page</a></p>';
    // Add more details from your data here, e.g., description, tracklist, etc.
    echo '</div>';
    echo '</div>';
    
    // Stop execution to prevent the catalog table from showing
    exit; 

} 
// ====================================================================
// END NEW LOGIC
// ====================================================================


echo '<h2>Vinyl Catalog</h2>';

// --- Sort Vinyls by Name ---
usort($vinyls, function ($a, $b) {
    $nameA = isset($a['title']) ? strtolower($a['title']) : '';
    $nameB = isset($b['title']) ? strtolower($b['title']) : '';
    return strcmp($nameA, $nameB);
});

echo '<div class="vinyl-grid">';

foreach ($vinyls as $vinyl) {
    $id = $vinyl['id'];
    $name = $vinyl['title'];
    $year = $vinyl['copyright_year'];
    $display = isset($vinyl['hide']) ? (bool) $vinyl['hide'] : false;
    
    // Using a placeholder if 'cover_url' doesn't exist in your array
    $cover = isset($vinyl['thumbnail_url']) ? $vinyl['thumbnail_url'] : 'https://static.lifeofpablo.com/media/vinyls/placeholder.png';

    if (!$display) {
        $single_page_url = 'vinyls?id=' . urlencode($id);

        echo '<div class="vinyl-item">';
            echo '<a href="' . $single_page_url . '">';
                echo '<img src="' . $cover . '" alt="Cover">';
                echo '<strong>' . $name . '</strong>';
            echo '</a>';
            echo '<span>' . $year . '</span>';
        echo '</div>';
    }
}

echo '</div>';

?>

<div class="permalink">Permalink: <a class="u-url" href="https://lifeofpablo.com<?php echo $this->yellow->page->getLocation($absoluteLocation = false) ?>">https://lifeofpablo.com<?php echo $this->yellow->page->getLocation($absoluteLocation = false) ?></a>
  








</div>

  <?php $this->yellow->layout("footer") ?>
